# **what?**
# Checks that a file has been committed under the /.changes directory
# as a new CHANGELOG entry.  Cannot check for a specific filename as
# it is dynamically generated by change type and timestamp.
# This workflow should not require any secrets since it runs for PRs
# from forked repos.
# By default, secrets are not passed to workflows running from
# a forked repo.

# **why?**
# Ensure code change gets reflected in the CHANGELOG.

# **when?**
# This will run for all PRs going into main and *.latest.

name: Check Changelog Entry

on:
  push:
    branches:
      - "main"
      - "*.latest"
  pull_request:
  workflow_dispatch:

permissions: read-all

defaults:
  run:
    shell: bash

jobs:
  changelog:
    name: changelog

    runs-on: ubuntu-latest

    steps:
      - name: Run changed-files on .changes/unreleased
        id: changed-files-for-unreleased
        uses: tj-actions/changed-files@v17
        with:
          path: /.changes/unreleased
      - name: Check a file has been added to .changes/unreleased
        run: |
          for file in ${{ steps.changed-files-for-unreleased.outputs.added_files }}; do
            echo "$file was added"
          done
